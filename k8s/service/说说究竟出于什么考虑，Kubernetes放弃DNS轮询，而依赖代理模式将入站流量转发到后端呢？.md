###  è¯´è¯´ç©¶ç«Ÿå‡ºäºä»€ä¹ˆè€ƒè™‘ï¼ŒKubernetesæ”¾å¼ƒDNSè½®è¯¢ï¼Œè€Œä¾èµ–ä»£ç†æ¨¡å¼å°†å…¥ç«™æµé‡è½¬å‘åˆ°åç«¯å‘¢ï¼Ÿ

> é¢è¯•å®˜ï¼š"è¯´è¯´ç©¶ç«Ÿå‡ºäºä»€ä¹ˆè€ƒè™‘ï¼ŒKubernetesæ”¾å¼ƒDNSè½®è¯¢ï¼Œè€Œä¾èµ–ä»£ç†æ¨¡å¼å°†å…¥ç«™æµé‡è½¬å‘åˆ°åç«¯å‘¢ï¼Ÿ"
>
> é¢è¯•å®˜ï¼š"ç®€å•æè¿°ä¸€ä¸‹ä»€ä¹ˆæ˜¯serviceï¼Ÿ"
>
> é¢è¯•å®˜ï¼š"k8sä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡æœºåˆ¶å‘¢ï¼Ÿç†ç”±ï¼Ÿ"
>
> é¢è¯•å®˜ï¼š"æåˆ°DNSè½®è¯¢å°±ä¸å¾—ä¸è¯´DNSç¼“å­˜äº†ï¼Œé‚£ä»€ä¹ˆæ˜¯DNSç¼“å­˜å‘¢?"

![img](https://img-blog.csdnimg.cn/img_convert/1e6eb5329506cac17e548ace1c606dfa.png)



### å›§ä¹ˆè‚¥äº‹-èƒ¡è¯´å…«é“



![img](https://img-blog.csdnimg.cn/img_convert/df1576c00d4e1bd94c74e9df2e445e2f.png)



![img](https://img-blog.csdnimg.cn/img_convert/3f59250a69d7add4d0af9f54a6a1d673.png)



### é¢è¯•å®˜ï¼š"ç®€å•æè¿°ä¸€ä¸‹ä»€ä¹ˆæ˜¯serviceï¼Ÿ"

k8så®šä¹‰æœåŠ¡æ˜¯ä¸€ç§**å°†è¿è¡Œåœ¨ä¸€ç»„ Pods ä¸Šçš„åº”ç”¨ç¨‹åºå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡**çš„æŠ½è±¡æ–¹æ³•ã€‚Kubernetes ä¸º Pods æä¾›è‡ªå·±çš„ IP åœ°å€ï¼Œå¹¶**ä¸ºä¸€ç»„ Pod æä¾›ç›¸åŒçš„ DNS å**ï¼Œ å¹¶ä¸”å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚è€Œä¸”ä½¿ç”¨ Kubernetesï¼Œä½ **æ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åº**ï¼Œå³å¯ä½¿ç”¨ä¸ç†Ÿæ‚‰çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œé»‘ç›’å¼ä½¿ç”¨ï¼Œç®€å•æ˜“ä¸Šæ‰‹ã€‚

![img](https://img-blog.csdnimg.cn/img_convert/799dceaa42fe931f821d3657067aee14.gif)



### é¢è¯•å®˜ï¼š"k8sä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡æœºåˆ¶å‘¢ï¼Ÿç†ç”±ï¼Ÿ"

k8séœ€è¦æœåŠ¡çš„åŠ¨æœºæ˜¯ï¼šPod æ˜¯**éæ°¸ä¹…æ€§èµ„æºï¼Œé¢ä¸´å„ç§é€‚åº”æ€§åˆ›å»ºå’Œé”€æ¯**ï¼ŒæœåŠ¡æœºåˆ¶çš„**ç›®æ ‡**æ˜¯ï¼Œä¸ç®¡k8sé›†ç¾¤å› ä¸ºä»€ä¹ˆæƒ…å†µï¼Œå¯¼è‡´çš„Podsä¸ºäº†é€‚é…é›†ç¾¤ç¯å¢ƒçŠ¶æ€ï¼Œè€Œè¿›è¡Œåˆ›å»ºå’Œé”€æ¯ Pod åï¼Œk8s ä¾ç„¶èƒ½æ­£ç¡®çš„åŒ¹é…é›†ç¾¤çŠ¶æ€ã€‚

ä»¥ Deployment å·¥ä½œè´Ÿè½½ä¸ºä¾‹ï¼Œå®ƒå¯ä»¥åŠ¨æ€åˆ›å»ºå’Œé”€æ¯ Pod ï¼Œk8s è®¾è®¡æ¶æ„å†³å®šäº†**æ¯ä¸ª Pod éƒ½æœ‰è‡ªå·±çš„ IP åœ°å€**ï¼Œåœ¨ Deployment ä¸­ï¼Œåœ¨**æŸä¸€æ—¶åˆ»**è¿è¡Œçš„ Pod é›†åˆå¯èƒ½ä¸**ç¨å**è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„ Pod é›†åˆä¸åŒã€‚

> è¿™ä¹ˆè¯´å§ï¼Œ9ç‚¹10åˆ†æä¾›æœåŠ¡çš„ Pod é›†åˆå¯èƒ½åˆ°9ç‚¹20åˆ†å·²ç»å…¨éƒ¨éƒ½è¢«æ›¿æ¢æˆæ–°çš„ Pod é›†åˆäº†
>
> ç»™ä½ æä¾›ç†å‘æœåŠ¡çš„æŠ€å¸ˆï¼Œè™½ç„¶éƒ½èƒ½ç»™ä½ ä¿®å‰ªä¸€ä¸ªæ¼‚æ¼‚äº®äº®çš„å‘å‹ï¼Œä½†æ˜¯æä¾›æœåŠ¡çš„æŠ€å¸ˆå¯èƒ½ä»Šå¤©æ˜¯é©¬å…‹æ³¢æ³¢ï¼Œæ˜å¤©ä¹Ÿè®¸å°±æ˜¯éº¦å…‹è è äº†

è¿™å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸€ç»„ Podï¼ˆç§°ä¸ºâ€œåç«¯â€ï¼‰ä¸ºé›†ç¾¤å†…çš„å…¶ä»– Podï¼ˆç§°ä¸ºâ€œå‰ç«¯â€ï¼‰æä¾›åŠŸèƒ½ï¼Œ é‚£ä¹ˆå‰ç«¯å¦‚ä½•æ‰¾å‡ºå¹¶è·Ÿè¸ªè¦è¿æ¥çš„ IP åœ°å€ï¼Œ**ä»¥ä¾¿å‰ç«¯å¯ä»¥ä½¿ç”¨æä¾›å·¥ä½œè´Ÿè½½çš„åç«¯éƒ¨åˆ†**ï¼Ÿ

![img](https://img-blog.csdnimg.cn/img_convert/609536fc304a7f92561ff0cd8c23f67c.gif)



ä¸¾ä¸ªä¾‹å­ï¼Œå‰ç«¯éœ€è¦è°ƒç”¨ä¸€ä¸ªå›¾ç‰‡å‹ç¼©çš„åç«¯æœåŠ¡ï¼Œè¿™ä¸ªå›¾ç‰‡å‹ç¼©çš„åç«¯æœåŠ¡å‡è®¾å« ImageResizeServerï¼Œå®ƒè¿è¡Œäº† 3 ä¸ªå‰¯æœ¬ï¼Œè¿™äº›å‰¯æœ¬æ˜¯å¯äº’æ¢çš„ã€‚ç„¶è€Œç»„æˆè¿™ä¸€ç»„åç«¯ç¨‹åºçš„ Pod å®é™…ä¸Šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ï¼Œå‰ç«¯ä¸éœ€è¦å…³å¿ƒå®ƒä»¬è°ƒç”¨äº†å“ªä¸ªåç«¯å‰¯æœ¬ï¼Œå‰ç«¯å®¢æˆ·ç«¯**ä¸åº”è¯¥ä¹Ÿæ²¡å¿…è¦çŸ¥é“**ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦è·Ÿè¸ªè¿™ä¸€ç»„åç«¯çš„çŠ¶æ€ã€‚ä½ éšæ„ï¼Œçˆ±å’‹å’‹åœ°ï¼Œåªè¦æœ€ç»ˆç»™æˆ‘å¤„ç†å¥½äº†å°±è¡Œã€‚Service å®šä¹‰çš„æŠ½è±¡èƒ½å¤Ÿè§£è€¦"å‰ç«¯"å’Œ"åç«¯"æœåŠ¡å…³è”ï¼ŒServiceåœ¨å…¶ä¸­èµ·åˆ°äº†æ¡¥æ¢ä½œç”¨ã€‚

![img](https://img-blog.csdnimg.cn/img_convert/d66557ff5d3917701f2e871eb3d96676.gif)





### é¢è¯•å®˜ï¼š"ä¸ºä»€ä¹ˆKubernetesæ”¾å¼ƒDNSè½®è¯¢ï¼Œè€Œä¾èµ–ä»£ç†æ¨¡å¼å°†å…¥ç«™æµé‡è½¬å‘åˆ°åç«¯å‘¢ï¼Ÿ"

å‰é¢ç®€å•ä»‹ç»äº†ä»€ä¹ˆæ˜¯Serviceï¼Œä»¥åŠå®ƒåœ¨ k8sä¸­çš„ä½œç”¨ï¼Œç»´æŒ k8s é›†ç¾¤PodåŒ¹é…ç¨³æ€ã€‚

ä¸‹é¢è¿›å…¥æ­£é¢˜ğŸ˜‚ğŸ˜‚ğŸ˜‚

```
ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ DNS è½®è¯¢ï¼Ÿ
```



å¾ˆå¤šäººé¢è¯•æ—¶ä¸æ—¶å°±ä¼šæœ‰äººè¢«é—®åˆ°ä¸ºä»€ä¹ˆ Kubernetes ä¾èµ–ä»£ç†å°†å…¥ç«™æµé‡è½¬å‘åˆ°åç«¯ï¼Œè€Œä¸æ˜¯å…¶ä»–æ–¹æ³•å‘¢ï¼Ÿ

> ä¾‹å¦‚ï¼Œæ˜¯å¦å¯ä»¥é…ç½®å…·æœ‰å¤šä¸ª A å€¼ï¼ˆæˆ– IPv6 ä¸º AAAAï¼‰çš„ DNS è®°å½•ï¼Œå¹¶ä¾é è½®è¯¢åç§°è§£æï¼Ÿ

![img](https://img-blog.csdnimg.cn/img_convert/c04641694a5159218ee9a5634957be36.gif)



**æåˆ°DNSè½®è¯¢å°±ä¸å¾—ä¸è¯´DNSç¼“å­˜äº†ï¼Œé‚£ä»€ä¹ˆæ˜¯DNSç¼“å­˜å‘¢?**

DNSç¼“å­˜æŒ‡DNSè¿”å›äº†æ­£ç¡®çš„IPä¹‹åï¼Œç³»ç»Ÿå°±ä¼šå°†è¿™ä¸ª**ç»“æœä¸´æ—¶å‚¨å­˜èµ·**æ¥ã€‚å¹¶ä¸”å®ƒä¼šä¸ºç¼“å­˜è®¾å®šä¸€ä¸ª**å¤±æ•ˆæ—¶é—´** (ä¾‹å¦‚Nå°æ—¶)ï¼Œåœ¨è¿™Nå°æ—¶ä¹‹å†…ï¼Œå½“ä½ å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œç³»ç»Ÿå°±ä¼šç›´æ¥ä»ä½ ç”µè„‘æœ¬åœ°çš„DNSç¼“å­˜ä¸­æŠŠç»“æœäº¤è¿˜ç»™ä½ ï¼Œè€Œä¸å¿…å†å»è¯¢é—®DNSæœåŠ¡å™¨ï¼Œ**å˜ç›¸â€œåŠ é€Ÿâ€äº†ç½‘å€çš„è§£æ**ã€‚åœ¨è¶…è¿‡Nå°æ—¶ä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å†æ¬¡å»è¯¢é—®DNSæœåŠ¡å™¨è·å¾—æ–°çš„ç»“æœã€‚æ‰€ä»¥ï¼Œå½“ä½ ä¿®æ”¹äº† DNS æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸å¸Œæœ›ç”µè„‘ç»§ç»­ä½¿ç”¨ä¹‹å‰çš„DNSç¼“å­˜æ—¶ï¼Œå°±éœ€è¦æ‰‹åŠ¨å»æ¸…é™¤æœ¬åœ°çš„ç¼“å­˜äº†ã€‚

**k8sä½¿ç”¨æœåŠ¡ä»£ç†ä¸»è¦å‡ ä¸ªåŸå› **ï¼š

- DNS ä¸éµå®ˆè®°å½• TTLï¼Œåœ¨**TTLå€¼åˆ°æœŸåï¼Œä¾ç„¶å¯¹ç»“æœè¿›è¡Œç¼“å­˜**ã€‚
- æœ‰äº›åº”ç”¨ç¨‹åºä»…æ‰§è¡Œä¸€æ¬¡ DNS æŸ¥æ‰¾ï¼Œä½†æ˜¯å´ä¼š**æ— é™æœŸåœ°ç¼“å­˜ç»“æœ**ã€‚
- å³ä½¿åº”ç”¨å’Œåº“è¿›è¡Œäº†é€‚å½“çš„é‡æ–°è§£æï¼Œ**DNS è®°å½•ä¸Šçš„ TTL å€¼ä½æˆ–ä¸ºé›¶ä¹Ÿå¯èƒ½ä¼šç»™ DNS å¸¦æ¥é«˜è´Ÿè½½**ï¼Œä»è€Œä½¿ç®¡ç†å˜å¾—å›°éš¾ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª Node è¿è¡Œä¸€ä¸ª `kube-proxy` è¿›ç¨‹ã€‚è€Œ`kube-proxy` è´Ÿè´£ä¸º Service å®ç°äº†ä¸€ç§ VIPï¼ˆè™šæ‹Ÿ IPï¼‰çš„å½¢å¼ï¼Œè€Œä¸æ˜¯ ExternalName çš„å½¢å¼ã€‚

![img](https://img-blog.csdnimg.cn/img_convert/098e33a5ee28010a163ae4cfed6fcff8.png)


k8sç³»åˆ—æ‰€æœ‰é—®é¢˜æ›´æ–°è®°å½•ï¼š[GitHub](https://gitee.com/jiongmefeishi/JMFS-Interview-Notebook-Kubernetes) , [Gitee](https://gitee.com/jiongmefeishi/JMFS-Interview-Notebook-Kubernetes)

