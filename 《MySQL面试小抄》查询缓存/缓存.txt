a MySQL服务器高负载情况下，我们需要采取一种措施给服务器减轻压力

a 众所周知，查询是最消耗性能的

a 其中磁盘IO占据主要资源

缓存是对系统性能优化的一种重要手段

今天我们叫聊聊MySQL的查询缓存

你先简单介绍一下什么是查询缓存？

b 
查询缓存机制设计是为了从根本上减少磁盘IO次数

MySQL 开启缓存后，将SQL和结果集以键值对KV的形式存储在内存

当相同的SQL再次进入，MySQL会直接返回缓存在内存中的结果集

不再需要经过一系列复杂的解析优化和磁盘IO过程

a 如何命中缓存？

select id from user;
select id FROM user;

上面语句能命中缓存吗？


b 不能

MySQL缓存命中机制有严格苛刻的要求

在判断命中前，MySQL不会对SQL做任何的解析处理

而是使用客户端传递的原SQL去查询缓存

SQL上的任何字符的不同，如大小写、空格、注释等都会导致缓存不命中


a 什么场景下SQL和结果集不会被缓存？或者说缓存规则是什么？

b 1、查询语句中包含不确定数据，例如查询语句中包含：NOW()、CURRENT_DATE()等。因为每次执行这类带了不确定数据的查询所返回结果可能是不同的。
2、超过了query_cache_limit预设阈值

a 什么场景下会导致MySQL缓存失效？

b 任何对于表结构或者表数据的更新操作，都会造成查询缓存中的数据失效，查询缓存值的相关条目将被清空

MySQL判定有更新操作，就会设置所有的查询缓存失效

a MySQL4.0提出了查询缓存，它设计出来是为了加速那些查询场景？

b 
1、并发性和查询QPS不高
2、被访问的底层数据本质上是静态或半静态的
3、查询密集型应用，更新频率非常低而只读查询频率非常高的场景

a MySQL5.6中默认禁用，8.0以后完全移除，造成这个改变的原因是什么？

b 

理想情况下，上述查询场景非常适合使用查询缓存

但是实际的业务系统都是有CRUD操作的

在MySQL里QC是由一个全局锁在控制，每次更新QC的内存块都需要进行锁定，数据更新频繁，就会不断的失效缓存操作，查询接口的QPS比较高。

同时缓存失效会造成大量的查询缓存碎片化

更加还会导致服务器的负载升高，影响数据库的稳定性


a 生产要不要开启MySQL缓存


b 
根据MySQL官方的测试，如果对一个表执行简单的查询，但每次查询都不一样的话，打开QC后，性能反而下降了13%左右

当然实际业务中，不会都是这种不同的请求，因此实际影响应该比这个小一些。




b 

a 

b 

a 

b 
什么是查询缓存？
如何命中缓存？
什么场景下SQL和结果集不会被缓存？或者说缓存规则是什么？
什么场景下会导致MySQL缓存失效？

a 

b 

a 

b 

1.MySQL查询缓存是什么？
2. MySQL缓存规则是什么？
3. 如何配置和缓存MySQL缓存
4. MySQL缓存的优缺点
5. 生产要不要开启MySQL缓存